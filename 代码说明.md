# 代码运行说明  

代码目录下，*.txt中保存的都是数加平台上运行的SQL语句（和PAI命令）。  
本文顺序即为代码运行顺序。  
流程思路可以参考“解题思路.md”。  

## 1.预处理
#### 1.1 
代码目录中：	`预处理 -> 分车型看乘的倍数.txt`

## 2.特征工程
解题思路中“预处理”章节的一部分内容在本文中归到“特征工程”章节内了。
#### 2.1
代码目录中：	`特征工程 -> 1_先还原成原始销量.txt`

#### 2.2
代码目录中：	`特征工程 -> 2_分省市车型按时间统计销量.txt`

#### 2.3.0
代码目录中：	`特征工程 -> 3_0_生成oc特征.txt`

#### 2.3.1
代码目录中：	`特征工程 -> 3_1_拼上oc特征.txt`

#### 2.4.1
代码目录中：	`特征工程 -> 4_1_省市车型时间.txt`

#### 2.4.2
代码目录中：	`特征工程 -> 4_2_ssm_车型.txt`

#### 2.4.3
代码目录中：	`特征工程 -> 4_3_fdfrfir_车型.txt`

#### 2.5.0
代码目录中：	`特征工程 -> 5_0_分出轿车suvmpv等类别.txt`

#### 2.5.1
代码目录中：	`特征工程 -> 5_1_省市车类型时间.txt`

#### 2.5.1.2
代码目录中：	`特征工程 -> 5_1_2_ssm_车类型.txt`

#### 2.5.1.3
代码目录中：	`特征工程 -> 5_1_3_fdfrfir_车类型.txt`

#### 2.5.2.0
代码目录中：	`特征工程 -> 5_2_0_按排量分.txt`

#### 2.5.2.1
代码目录中：	`特征工程 -> 5_2_1_省市排量时间.txt`

#### 2.5.2.2
代码目录中：	`特征工程 -> 5_2_2_ssm_排量.txt`

#### 2.5.2.3
代码目录中：	`特征工程 -> 5_2_3_fdfrfir_排量.txt`

#### 2.5.3.0
代码目录中：	`特征工程 -> 5_3_0_按新能源类别分.txt`

#### 2.5.3.1
代码目录中：	`特征工程 -> 5_3_1_省市新能源时间.txt`

#### 2.5.3.2
代码目录中：	`特征工程 -> 5_3_2_ssm_新能源.txt`

#### 2.5.3.3
代码目录中：	`特征工程 -> 5_3_3_fdfrfir_新能源.txt`


#### 2.6.0.1
代码目录中：	`特征工程 -> 6_0_1_省市时间开窗之车型.txt`

#### 2.6.0.2
代码目录中：	`特征工程 -> 6_0_2_省市时间开窗之车类型.txt`

#### 2.6.0.3
代码目录中：	`特征工程 -> 6_0_3_省市时间开窗之排量.txt`

#### 2.6.0.4
代码目录中：	`特征工程 -> 6_0_4_省市时间开窗之新能源.txt`


#### 2.7.1
代码目录中：	`特征工程 -> 7_1_省市车型历史交叉.txt`

#### 2.7.2
代码目录中：	`特征工程 -> 7_2_省市车类型交叉.txt`

#### 2.7.3
代码目录中：	`特征工程 -> 7_3_省市排量交叉.txt`

#### 2.7.4  
代码目录中：	`特征工程 -> 7_4_省市新能源交叉.txt`  



#### 2.8.0  
join各个特征：在PAI平台完成。    
实验目录及实验名为：`for_Feb_prediction` -> `JOIN_before_f8`  
截图所在目录：`截图` -> `JOIN_before_f8`  
![](https://note.youdao.com/yws/public/resource/b1fac6368ce6469bfed546a0b1e310d3/xmlnote/95180E114C5248B2A26C6B2E62A02549/5534)



#### 2.8.0.1
代码目录中：	`特征工程 -> 8_0_时间之年月.txt`


## 3.数据集拆分及训练集构建
####3.1 拆分
在PAI平台完成。
实验目录及实验名为：`for_Feb_prediction` -> `5份数据集拆分_都是跳一个月`
截图所在目录：`截图` -> `5份数据集拆分.png`
![](https://note.youdao.com/yws/public/resource/b1fac6368ce6469bfed546a0b1e310d3/xmlnote/139EB8BDA7AD44428CC5F4D5A6551062/5541)

事实上，只运行最左边那一块（拆分出 dataset0_train_f8 和 dataset0_test_f8 的）即可。

#### 3.2 训练集构建
所谓训练集构建，即为了最终训练的XGB之一，使用近三年的sale_date为2月的记录作为训练集。因此要从dataset0_train_f8中选出二月的。

代码目录中：	`特征工程 -> 选出二月的作为训练集.txt`

## 4.模型训练
**说明**：
1. 【这里有bug】平台上总是无法保存完整的下述PAI命令，运行这里时**需要从代码目录中的相应文件中，手动将代码和参数复制过去**。  
2. 最终训练了两个XGB，一个用了完整的近三年数据训练，另一个仅用了近三年中2月的数据训练。二者代码一样，参数不同，详见下述。  

### 运行流程  
1. 运行下述第一个模型（其中包括了训练和预测）；  
2. 运行PAI实验：`for_Feb_prediction` -> `XGB结果处理`  
	其中右下角的写数据表的输出表名应指定为：`final_result_xgb_skip_jan`；  
	
	截图所在目录：`截图` -> `XGB结果处理.png`  
	![](https://note.youdao.com/yws/public/resource/b1fac6368ce6469bfed546a0b1e310d3/xmlnote/6D723DD0104A48D697EE4A0F6A0EB0BC/5543)  

3. 运行第二个模型；  
4. 运行PAI实验：`for_Feb_prediction` -> `XGB结果处理`  
	其中右下角的写数据表的输出表名应指定为：`xgb_trained_with_febs`；  


### 模型代码：  
代码目录中：	`模型训练 -> XGB.txt`  

### 模型1参数：  
eta=0.006    
round=145  
train_X=dataset0_train_f8   
test_X=dataset0_test_f8  
features 见代码目录内的 `模型训练 -> 输入特征.txt`  

### 模型2参数：  
train_X=dataset0_train_feb  
round=140  
其他参数同模型1。  


## 5.结果融合
运行PAI实验：`for_Feb_prediction` -> `融合`。  
截图所在目录：`截图` -> `融合.png`  
![](https://note.youdao.com/yws/public/resource/b1fac6368ce6469bfed546a0b1e310d3/xmlnote/947FB6A3EB1C402C9E4C2FBCCE86436C/5545)  



最终结果表为`yc_result_submit_b`。
