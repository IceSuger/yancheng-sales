drop table if exists whole_f4_step2;
create table whole_f4_step2 as 
select *, to_date(sale_date, 'yyyymm') as sale_date_dt
from whole_f3;



create table d__has_c_real_som2 as select a.*, b.real_sale as c_real_som2 from whole_f4_step2 a left outer join whole_f4_step2 b on a.sale_date_dt = dateadd(b.sale_date_dt, 2, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som3 as select a.*, b.real_sale as c_real_som3 from d__has_c_real_som2 a left outer join d__has_c_real_som2 b on a.sale_date_dt = dateadd(b.sale_date_dt, 3, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som4 as select a.*, b.real_sale as c_real_som4 from d__has_c_real_som3 a left outer join d__has_c_real_som3 b on a.sale_date_dt = dateadd(b.sale_date_dt, 4, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som5 as select a.*, b.real_sale as c_real_som5 from d__has_c_real_som4 a left outer join d__has_c_real_som4 b on a.sale_date_dt = dateadd(b.sale_date_dt, 5, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som6 as select a.*, b.real_sale as c_real_som6 from d__has_c_real_som5 a left outer join d__has_c_real_som5 b on a.sale_date_dt = dateadd(b.sale_date_dt, 6, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som7 as select a.*, b.real_sale as c_real_som7 from d__has_c_real_som6 a left outer join d__has_c_real_som6 b on a.sale_date_dt = dateadd(b.sale_date_dt, 7, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som8 as select a.*, b.real_sale as c_real_som8 from d__has_c_real_som7 a left outer join d__has_c_real_som7 b on a.sale_date_dt = dateadd(b.sale_date_dt, 8, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som9 as select a.*, b.real_sale as c_real_som9 from d__has_c_real_som8 a left outer join d__has_c_real_som8 b on a.sale_date_dt = dateadd(b.sale_date_dt, 9, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som10 as select a.*, b.real_sale as c_real_som10 from d__has_c_real_som9 a left outer join d__has_c_real_som9 b on a.sale_date_dt = dateadd(b.sale_date_dt, 10, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som11 as select a.*, b.real_sale as c_real_som11 from d__has_c_real_som10 a left outer join d__has_c_real_som10 b on a.sale_date_dt = dateadd(b.sale_date_dt, 11, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som12 as select a.*, b.real_sale as c_real_som12 from d__has_c_real_som11 a left outer join d__has_c_real_som11 b on a.sale_date_dt = dateadd(b.sale_date_dt, 12, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som13 as select a.*, b.real_sale as c_real_som13 from d__has_c_real_som12 a left outer join d__has_c_real_som12 b on a.sale_date_dt = dateadd(b.sale_date_dt, 13, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som14 as select a.*, b.real_sale as c_real_som14 from d__has_c_real_som13 a left outer join d__has_c_real_som13 b on a.sale_date_dt = dateadd(b.sale_date_dt, 14, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som15 as select a.*, b.real_sale as c_real_som15 from d__has_c_real_som14 a left outer join d__has_c_real_som14 b on a.sale_date_dt = dateadd(b.sale_date_dt, 15, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som16 as select a.*, b.real_sale as c_real_som16 from d__has_c_real_som15 a left outer join d__has_c_real_som15 b on a.sale_date_dt = dateadd(b.sale_date_dt, 16, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som17 as select a.*, b.real_sale as c_real_som17 from d__has_c_real_som16 a left outer join d__has_c_real_som16 b on a.sale_date_dt = dateadd(b.sale_date_dt, 17, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som18 as select a.*, b.real_sale as c_real_som18 from d__has_c_real_som17 a left outer join d__has_c_real_som17 b on a.sale_date_dt = dateadd(b.sale_date_dt, 18, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som19 as select a.*, b.real_sale as c_real_som19 from d__has_c_real_som18 a left outer join d__has_c_real_som18 b on a.sale_date_dt = dateadd(b.sale_date_dt, 19, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som20 as select a.*, b.real_sale as c_real_som20 from d__has_c_real_som19 a left outer join d__has_c_real_som19 b on a.sale_date_dt = dateadd(b.sale_date_dt, 20, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som21 as select a.*, b.real_sale as c_real_som21 from d__has_c_real_som20 a left outer join d__has_c_real_som20 b on a.sale_date_dt = dateadd(b.sale_date_dt, 21, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som22 as select a.*, b.real_sale as c_real_som22 from d__has_c_real_som21 a left outer join d__has_c_real_som21 b on a.sale_date_dt = dateadd(b.sale_date_dt, 22, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som23 as select a.*, b.real_sale as c_real_som23 from d__has_c_real_som22 a left outer join d__has_c_real_som22 b on a.sale_date_dt = dateadd(b.sale_date_dt, 23, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som24 as select a.*, b.real_sale as c_real_som24 from d__has_c_real_som23 a left outer join d__has_c_real_som23 b on a.sale_date_dt = dateadd(b.sale_date_dt, 24, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som25 as select a.*, b.real_sale as c_real_som25 from d__has_c_real_som24 a left outer join d__has_c_real_som24 b on a.sale_date_dt = dateadd(b.sale_date_dt, 25, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som26 as select a.*, b.real_sale as c_real_som26 from d__has_c_real_som25 a left outer join d__has_c_real_som25 b on a.sale_date_dt = dateadd(b.sale_date_dt, 26, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som27 as select a.*, b.real_sale as c_real_som27 from d__has_c_real_som26 a left outer join d__has_c_real_som26 b on a.sale_date_dt = dateadd(b.sale_date_dt, 27, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som28 as select a.*, b.real_sale as c_real_som28 from d__has_c_real_som27 a left outer join d__has_c_real_som27 b on a.sale_date_dt = dateadd(b.sale_date_dt, 28, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som29 as select a.*, b.real_sale as c_real_som29 from d__has_c_real_som28 a left outer join d__has_c_real_som28 b on a.sale_date_dt = dateadd(b.sale_date_dt, 29, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som30 as select a.*, b.real_sale as c_real_som30 from d__has_c_real_som29 a left outer join d__has_c_real_som29 b on a.sale_date_dt = dateadd(b.sale_date_dt, 30, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som31 as select a.*, b.real_sale as c_real_som31 from d__has_c_real_som30 a left outer join d__has_c_real_som30 b on a.sale_date_dt = dateadd(b.sale_date_dt, 31, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som32 as select a.*, b.real_sale as c_real_som32 from d__has_c_real_som31 a left outer join d__has_c_real_som31 b on a.sale_date_dt = dateadd(b.sale_date_dt, 32, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som33 as select a.*, b.real_sale as c_real_som33 from d__has_c_real_som32 a left outer join d__has_c_real_som32 b on a.sale_date_dt = dateadd(b.sale_date_dt, 33, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som34 as select a.*, b.real_sale as c_real_som34 from d__has_c_real_som33 a left outer join d__has_c_real_som33 b on a.sale_date_dt = dateadd(b.sale_date_dt, 34, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som35 as select a.*, b.real_sale as c_real_som35 from d__has_c_real_som34 a left outer join d__has_c_real_som34 b on a.sale_date_dt = dateadd(b.sale_date_dt, 35, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som36 as select a.*, b.real_sale as c_real_som36 from d__has_c_real_som35 a left outer join d__has_c_real_som35 b on a.sale_date_dt = dateadd(b.sale_date_dt, 36, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som37 as select a.*, b.real_sale as c_real_som37 from d__has_c_real_som36 a left outer join d__has_c_real_som36 b on a.sale_date_dt = dateadd(b.sale_date_dt, 37, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som38 as select a.*, b.real_sale as c_real_som38 from d__has_c_real_som37 a left outer join d__has_c_real_som37 b on a.sale_date_dt = dateadd(b.sale_date_dt, 38, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som39 as select a.*, b.real_sale as c_real_som39 from d__has_c_real_som38 a left outer join d__has_c_real_som38 b on a.sale_date_dt = dateadd(b.sale_date_dt, 39, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;
create table d__has_c_real_som40 as select a.*, b.real_sale as c_real_som40 from d__has_c_real_som39 a left outer join d__has_c_real_som39 b on a.sale_date_dt = dateadd(b.sale_date_dt, 40, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.class_id = b.class_id;

alter table d__has_c_real_som40 rename to whole_f4_step3;