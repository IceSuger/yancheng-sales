drop table if exists whole_f5_2_step2;
create table whole_f5_2_step2 as 
select *, to_date(sale_date, 'yyyymm') as sale_date_dt
from whole_f5_2_step1;



create table d__has_c_real_som_displace_level_2 as select a.*, b.real_sale as c_real_som_displace_level_2 from whole_f5_2_step2 a left outer join whole_f5_2_step2 b on a.sale_date_dt = dateadd(b.sale_date_dt, 2, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_3 as select a.*, b.real_sale as c_real_som_displace_level_3 from d__has_c_real_som_displace_level_2 a left outer join d__has_c_real_som_displace_level_2 b on a.sale_date_dt = dateadd(b.sale_date_dt, 3, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_4 as select a.*, b.real_sale as c_real_som_displace_level_4 from d__has_c_real_som_displace_level_3 a left outer join d__has_c_real_som_displace_level_3 b on a.sale_date_dt = dateadd(b.sale_date_dt, 4, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_5 as select a.*, b.real_sale as c_real_som_displace_level_5 from d__has_c_real_som_displace_level_4 a left outer join d__has_c_real_som_displace_level_4 b on a.sale_date_dt = dateadd(b.sale_date_dt, 5, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_6 as select a.*, b.real_sale as c_real_som_displace_level_6 from d__has_c_real_som_displace_level_5 a left outer join d__has_c_real_som_displace_level_5 b on a.sale_date_dt = dateadd(b.sale_date_dt, 6, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_7 as select a.*, b.real_sale as c_real_som_displace_level_7 from d__has_c_real_som_displace_level_6 a left outer join d__has_c_real_som_displace_level_6 b on a.sale_date_dt = dateadd(b.sale_date_dt, 7, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_8 as select a.*, b.real_sale as c_real_som_displace_level_8 from d__has_c_real_som_displace_level_7 a left outer join d__has_c_real_som_displace_level_7 b on a.sale_date_dt = dateadd(b.sale_date_dt, 8, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_9 as select a.*, b.real_sale as c_real_som_displace_level_9 from d__has_c_real_som_displace_level_8 a left outer join d__has_c_real_som_displace_level_8 b on a.sale_date_dt = dateadd(b.sale_date_dt, 9, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_10 as select a.*, b.real_sale as c_real_som_displace_level_10 from d__has_c_real_som_displace_level_9 a left outer join d__has_c_real_som_displace_level_9 b on a.sale_date_dt = dateadd(b.sale_date_dt, 10, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_11 as select a.*, b.real_sale as c_real_som_displace_level_11 from d__has_c_real_som_displace_level_10 a left outer join d__has_c_real_som_displace_level_10 b on a.sale_date_dt = dateadd(b.sale_date_dt, 11, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_12 as select a.*, b.real_sale as c_real_som_displace_level_12 from d__has_c_real_som_displace_level_11 a left outer join d__has_c_real_som_displace_level_11 b on a.sale_date_dt = dateadd(b.sale_date_dt, 12, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_13 as select a.*, b.real_sale as c_real_som_displace_level_13 from d__has_c_real_som_displace_level_12 a left outer join d__has_c_real_som_displace_level_12 b on a.sale_date_dt = dateadd(b.sale_date_dt, 13, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_14 as select a.*, b.real_sale as c_real_som_displace_level_14 from d__has_c_real_som_displace_level_13 a left outer join d__has_c_real_som_displace_level_13 b on a.sale_date_dt = dateadd(b.sale_date_dt, 14, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_15 as select a.*, b.real_sale as c_real_som_displace_level_15 from d__has_c_real_som_displace_level_14 a left outer join d__has_c_real_som_displace_level_14 b on a.sale_date_dt = dateadd(b.sale_date_dt, 15, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_16 as select a.*, b.real_sale as c_real_som_displace_level_16 from d__has_c_real_som_displace_level_15 a left outer join d__has_c_real_som_displace_level_15 b on a.sale_date_dt = dateadd(b.sale_date_dt, 16, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_17 as select a.*, b.real_sale as c_real_som_displace_level_17 from d__has_c_real_som_displace_level_16 a left outer join d__has_c_real_som_displace_level_16 b on a.sale_date_dt = dateadd(b.sale_date_dt, 17, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_18 as select a.*, b.real_sale as c_real_som_displace_level_18 from d__has_c_real_som_displace_level_17 a left outer join d__has_c_real_som_displace_level_17 b on a.sale_date_dt = dateadd(b.sale_date_dt, 18, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_19 as select a.*, b.real_sale as c_real_som_displace_level_19 from d__has_c_real_som_displace_level_18 a left outer join d__has_c_real_som_displace_level_18 b on a.sale_date_dt = dateadd(b.sale_date_dt, 19, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_20 as select a.*, b.real_sale as c_real_som_displace_level_20 from d__has_c_real_som_displace_level_19 a left outer join d__has_c_real_som_displace_level_19 b on a.sale_date_dt = dateadd(b.sale_date_dt, 20, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_21 as select a.*, b.real_sale as c_real_som_displace_level_21 from d__has_c_real_som_displace_level_20 a left outer join d__has_c_real_som_displace_level_20 b on a.sale_date_dt = dateadd(b.sale_date_dt, 21, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_22 as select a.*, b.real_sale as c_real_som_displace_level_22 from d__has_c_real_som_displace_level_21 a left outer join d__has_c_real_som_displace_level_21 b on a.sale_date_dt = dateadd(b.sale_date_dt, 22, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_23 as select a.*, b.real_sale as c_real_som_displace_level_23 from d__has_c_real_som_displace_level_22 a left outer join d__has_c_real_som_displace_level_22 b on a.sale_date_dt = dateadd(b.sale_date_dt, 23, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_24 as select a.*, b.real_sale as c_real_som_displace_level_24 from d__has_c_real_som_displace_level_23 a left outer join d__has_c_real_som_displace_level_23 b on a.sale_date_dt = dateadd(b.sale_date_dt, 24, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_25 as select a.*, b.real_sale as c_real_som_displace_level_25 from d__has_c_real_som_displace_level_24 a left outer join d__has_c_real_som_displace_level_24 b on a.sale_date_dt = dateadd(b.sale_date_dt, 25, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_26 as select a.*, b.real_sale as c_real_som_displace_level_26 from d__has_c_real_som_displace_level_25 a left outer join d__has_c_real_som_displace_level_25 b on a.sale_date_dt = dateadd(b.sale_date_dt, 26, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_27 as select a.*, b.real_sale as c_real_som_displace_level_27 from d__has_c_real_som_displace_level_26 a left outer join d__has_c_real_som_displace_level_26 b on a.sale_date_dt = dateadd(b.sale_date_dt, 27, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_28 as select a.*, b.real_sale as c_real_som_displace_level_28 from d__has_c_real_som_displace_level_27 a left outer join d__has_c_real_som_displace_level_27 b on a.sale_date_dt = dateadd(b.sale_date_dt, 28, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_29 as select a.*, b.real_sale as c_real_som_displace_level_29 from d__has_c_real_som_displace_level_28 a left outer join d__has_c_real_som_displace_level_28 b on a.sale_date_dt = dateadd(b.sale_date_dt, 29, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_30 as select a.*, b.real_sale as c_real_som_displace_level_30 from d__has_c_real_som_displace_level_29 a left outer join d__has_c_real_som_displace_level_29 b on a.sale_date_dt = dateadd(b.sale_date_dt, 30, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_31 as select a.*, b.real_sale as c_real_som_displace_level_31 from d__has_c_real_som_displace_level_30 a left outer join d__has_c_real_som_displace_level_30 b on a.sale_date_dt = dateadd(b.sale_date_dt, 31, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_32 as select a.*, b.real_sale as c_real_som_displace_level_32 from d__has_c_real_som_displace_level_31 a left outer join d__has_c_real_som_displace_level_31 b on a.sale_date_dt = dateadd(b.sale_date_dt, 32, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_33 as select a.*, b.real_sale as c_real_som_displace_level_33 from d__has_c_real_som_displace_level_32 a left outer join d__has_c_real_som_displace_level_32 b on a.sale_date_dt = dateadd(b.sale_date_dt, 33, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_34 as select a.*, b.real_sale as c_real_som_displace_level_34 from d__has_c_real_som_displace_level_33 a left outer join d__has_c_real_som_displace_level_33 b on a.sale_date_dt = dateadd(b.sale_date_dt, 34, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_35 as select a.*, b.real_sale as c_real_som_displace_level_35 from d__has_c_real_som_displace_level_34 a left outer join d__has_c_real_som_displace_level_34 b on a.sale_date_dt = dateadd(b.sale_date_dt, 35, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_36 as select a.*, b.real_sale as c_real_som_displace_level_36 from d__has_c_real_som_displace_level_35 a left outer join d__has_c_real_som_displace_level_35 b on a.sale_date_dt = dateadd(b.sale_date_dt, 36, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_37 as select a.*, b.real_sale as c_real_som_displace_level_37 from d__has_c_real_som_displace_level_36 a left outer join d__has_c_real_som_displace_level_36 b on a.sale_date_dt = dateadd(b.sale_date_dt, 37, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_38 as select a.*, b.real_sale as c_real_som_displace_level_38 from d__has_c_real_som_displace_level_37 a left outer join d__has_c_real_som_displace_level_37 b on a.sale_date_dt = dateadd(b.sale_date_dt, 38, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_39 as select a.*, b.real_sale as c_real_som_displace_level_39 from d__has_c_real_som_displace_level_38 a left outer join d__has_c_real_som_displace_level_38 b on a.sale_date_dt = dateadd(b.sale_date_dt, 39, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_displace_level_40 as select a.*, b.real_sale as c_real_som_displace_level_40 from d__has_c_real_som_displace_level_39 a left outer join d__has_c_real_som_displace_level_39 b on a.sale_date_dt = dateadd(b.sale_date_dt, 40, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;

alter table d__has_c_real_som_displace_level_40 rename to whole_f5_2_step3;