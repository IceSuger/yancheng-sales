drop table if exists whole_f5_3_step2;
create table whole_f5_3_step2 as 
select *, to_date(sale_date, 'yyyymm') as sale_date_dt
from whole_f5_3_step1;



create table d__has_c_real_som_ne_type_2 as select a.*, b.real_sale as c_real_som_ne_type_2 from whole_f5_2_step2 a left outer join whole_f5_2_step2 b on a.sale_date_dt = dateadd(b.sale_date_dt, 2, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_3 as select a.*, b.real_sale as c_real_som_ne_type_3 from d__has_c_real_som_ne_type_2 a left outer join d__has_c_real_som_ne_type_2 b on a.sale_date_dt = dateadd(b.sale_date_dt, 3, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_4 as select a.*, b.real_sale as c_real_som_ne_type_4 from d__has_c_real_som_ne_type_3 a left outer join d__has_c_real_som_ne_type_3 b on a.sale_date_dt = dateadd(b.sale_date_dt, 4, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_5 as select a.*, b.real_sale as c_real_som_ne_type_5 from d__has_c_real_som_ne_type_4 a left outer join d__has_c_real_som_ne_type_4 b on a.sale_date_dt = dateadd(b.sale_date_dt, 5, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_6 as select a.*, b.real_sale as c_real_som_ne_type_6 from d__has_c_real_som_ne_type_5 a left outer join d__has_c_real_som_ne_type_5 b on a.sale_date_dt = dateadd(b.sale_date_dt, 6, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_7 as select a.*, b.real_sale as c_real_som_ne_type_7 from d__has_c_real_som_ne_type_6 a left outer join d__has_c_real_som_ne_type_6 b on a.sale_date_dt = dateadd(b.sale_date_dt, 7, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_8 as select a.*, b.real_sale as c_real_som_ne_type_8 from d__has_c_real_som_ne_type_7 a left outer join d__has_c_real_som_ne_type_7 b on a.sale_date_dt = dateadd(b.sale_date_dt, 8, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_9 as select a.*, b.real_sale as c_real_som_ne_type_9 from d__has_c_real_som_ne_type_8 a left outer join d__has_c_real_som_ne_type_8 b on a.sale_date_dt = dateadd(b.sale_date_dt, 9, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_10 as select a.*, b.real_sale as c_real_som_ne_type_10 from d__has_c_real_som_ne_type_9 a left outer join d__has_c_real_som_ne_type_9 b on a.sale_date_dt = dateadd(b.sale_date_dt, 10, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_11 as select a.*, b.real_sale as c_real_som_ne_type_11 from d__has_c_real_som_ne_type_10 a left outer join d__has_c_real_som_ne_type_10 b on a.sale_date_dt = dateadd(b.sale_date_dt, 11, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_12 as select a.*, b.real_sale as c_real_som_ne_type_12 from d__has_c_real_som_ne_type_11 a left outer join d__has_c_real_som_ne_type_11 b on a.sale_date_dt = dateadd(b.sale_date_dt, 12, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_13 as select a.*, b.real_sale as c_real_som_ne_type_13 from d__has_c_real_som_ne_type_12 a left outer join d__has_c_real_som_ne_type_12 b on a.sale_date_dt = dateadd(b.sale_date_dt, 13, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_14 as select a.*, b.real_sale as c_real_som_ne_type_14 from d__has_c_real_som_ne_type_13 a left outer join d__has_c_real_som_ne_type_13 b on a.sale_date_dt = dateadd(b.sale_date_dt, 14, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_15 as select a.*, b.real_sale as c_real_som_ne_type_15 from d__has_c_real_som_ne_type_14 a left outer join d__has_c_real_som_ne_type_14 b on a.sale_date_dt = dateadd(b.sale_date_dt, 15, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_16 as select a.*, b.real_sale as c_real_som_ne_type_16 from d__has_c_real_som_ne_type_15 a left outer join d__has_c_real_som_ne_type_15 b on a.sale_date_dt = dateadd(b.sale_date_dt, 16, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_17 as select a.*, b.real_sale as c_real_som_ne_type_17 from d__has_c_real_som_ne_type_16 a left outer join d__has_c_real_som_ne_type_16 b on a.sale_date_dt = dateadd(b.sale_date_dt, 17, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_18 as select a.*, b.real_sale as c_real_som_ne_type_18 from d__has_c_real_som_ne_type_17 a left outer join d__has_c_real_som_ne_type_17 b on a.sale_date_dt = dateadd(b.sale_date_dt, 18, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_19 as select a.*, b.real_sale as c_real_som_ne_type_19 from d__has_c_real_som_ne_type_18 a left outer join d__has_c_real_som_ne_type_18 b on a.sale_date_dt = dateadd(b.sale_date_dt, 19, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_20 as select a.*, b.real_sale as c_real_som_ne_type_20 from d__has_c_real_som_ne_type_19 a left outer join d__has_c_real_som_ne_type_19 b on a.sale_date_dt = dateadd(b.sale_date_dt, 20, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_21 as select a.*, b.real_sale as c_real_som_ne_type_21 from d__has_c_real_som_ne_type_20 a left outer join d__has_c_real_som_ne_type_20 b on a.sale_date_dt = dateadd(b.sale_date_dt, 21, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_22 as select a.*, b.real_sale as c_real_som_ne_type_22 from d__has_c_real_som_ne_type_21 a left outer join d__has_c_real_som_ne_type_21 b on a.sale_date_dt = dateadd(b.sale_date_dt, 22, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_23 as select a.*, b.real_sale as c_real_som_ne_type_23 from d__has_c_real_som_ne_type_22 a left outer join d__has_c_real_som_ne_type_22 b on a.sale_date_dt = dateadd(b.sale_date_dt, 23, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_24 as select a.*, b.real_sale as c_real_som_ne_type_24 from d__has_c_real_som_ne_type_23 a left outer join d__has_c_real_som_ne_type_23 b on a.sale_date_dt = dateadd(b.sale_date_dt, 24, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_25 as select a.*, b.real_sale as c_real_som_ne_type_25 from d__has_c_real_som_ne_type_24 a left outer join d__has_c_real_som_ne_type_24 b on a.sale_date_dt = dateadd(b.sale_date_dt, 25, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_26 as select a.*, b.real_sale as c_real_som_ne_type_26 from d__has_c_real_som_ne_type_25 a left outer join d__has_c_real_som_ne_type_25 b on a.sale_date_dt = dateadd(b.sale_date_dt, 26, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_27 as select a.*, b.real_sale as c_real_som_ne_type_27 from d__has_c_real_som_ne_type_26 a left outer join d__has_c_real_som_ne_type_26 b on a.sale_date_dt = dateadd(b.sale_date_dt, 27, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_28 as select a.*, b.real_sale as c_real_som_ne_type_28 from d__has_c_real_som_ne_type_27 a left outer join d__has_c_real_som_ne_type_27 b on a.sale_date_dt = dateadd(b.sale_date_dt, 28, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_29 as select a.*, b.real_sale as c_real_som_ne_type_29 from d__has_c_real_som_ne_type_28 a left outer join d__has_c_real_som_ne_type_28 b on a.sale_date_dt = dateadd(b.sale_date_dt, 29, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_30 as select a.*, b.real_sale as c_real_som_ne_type_30 from d__has_c_real_som_ne_type_29 a left outer join d__has_c_real_som_ne_type_29 b on a.sale_date_dt = dateadd(b.sale_date_dt, 30, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_31 as select a.*, b.real_sale as c_real_som_ne_type_31 from d__has_c_real_som_ne_type_30 a left outer join d__has_c_real_som_ne_type_30 b on a.sale_date_dt = dateadd(b.sale_date_dt, 31, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_32 as select a.*, b.real_sale as c_real_som_ne_type_32 from d__has_c_real_som_ne_type_31 a left outer join d__has_c_real_som_ne_type_31 b on a.sale_date_dt = dateadd(b.sale_date_dt, 32, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_33 as select a.*, b.real_sale as c_real_som_ne_type_33 from d__has_c_real_som_ne_type_32 a left outer join d__has_c_real_som_ne_type_32 b on a.sale_date_dt = dateadd(b.sale_date_dt, 33, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_34 as select a.*, b.real_sale as c_real_som_ne_type_34 from d__has_c_real_som_ne_type_33 a left outer join d__has_c_real_som_ne_type_33 b on a.sale_date_dt = dateadd(b.sale_date_dt, 34, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_35 as select a.*, b.real_sale as c_real_som_ne_type_35 from d__has_c_real_som_ne_type_34 a left outer join d__has_c_real_som_ne_type_34 b on a.sale_date_dt = dateadd(b.sale_date_dt, 35, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_36 as select a.*, b.real_sale as c_real_som_ne_type_36 from d__has_c_real_som_ne_type_35 a left outer join d__has_c_real_som_ne_type_35 b on a.sale_date_dt = dateadd(b.sale_date_dt, 36, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_37 as select a.*, b.real_sale as c_real_som_ne_type_37 from d__has_c_real_som_ne_type_36 a left outer join d__has_c_real_som_ne_type_36 b on a.sale_date_dt = dateadd(b.sale_date_dt, 37, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_38 as select a.*, b.real_sale as c_real_som_ne_type_38 from d__has_c_real_som_ne_type_37 a left outer join d__has_c_real_som_ne_type_37 b on a.sale_date_dt = dateadd(b.sale_date_dt, 38, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_39 as select a.*, b.real_sale as c_real_som_ne_type_39 from d__has_c_real_som_ne_type_38 a left outer join d__has_c_real_som_ne_type_38 b on a.sale_date_dt = dateadd(b.sale_date_dt, 39, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;
create table d__has_c_real_som_ne_type_40 as select a.*, b.real_sale as c_real_som_ne_type_40 from d__has_c_real_som_ne_type_39 a left outer join d__has_c_real_som_ne_type_39 b on a.sale_date_dt = dateadd(b.sale_date_dt, 40, 'mm') and a.province_id = b.province_id and a.city_id = b.city_id and a.displacement_level = b.displacement_level;

alter table d__has_c_real_som_ne_type_40 rename to whole_f5_3_step3;